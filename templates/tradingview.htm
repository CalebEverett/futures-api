<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

    <title>Hello, world!</title>
</head>

<body>



    <div class="container-fluid">
        <h1>Perpetual Futures Strategy</h1>
        <div class="row">
            <div id="chart" class="col"></div>
            <div id="chart2" class="col"></div>
        </div>
    </div>
    <script>
        var chart = LightweightCharts.createChart(document.getElementById('chart'), {
            width: 1000,
            height: 500,
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            priceScale: {
                borderColor: 'rgba(197, 203, 206, 0.8)',
            },
            timeScale: {
                borderColor: 'rgba(197, 203, 206, 0.8)',
                timeVisible: true,
                secondsVisible: false,
            },
        });

        var candleSeries = chart.addCandlestickSeries()
        // var candleSeries = chart.addCandlestickSeries({
        //     upColor: '#00ff00',
        //     downColor: '#ff0000',
        //     borderDownColor: 'rgba(255, 144, 0, 1)',
        //     borderUpColor: 'rgba(255, 144, 0, 1)',
        //     wickDownColor: 'rgba(255, 144, 0, 1)',
        //     wickUpColor: 'rgba(255, 144, 0, 1)',
        // });

        fetch('http://localhost:8000/klines/futures/BTCUSDT')
            .then((r) => r.json())
            .then((response) => {
                console.log(response)

                candleSeries.setData(response);
            })


        var binanceSocket = new WebSocket("ws://localhost:8000/ws/futures/BTCUSDT");

        binanceSocket.onmessage = function (event) {
            var message = JSON.parse(event.data);
            candleSeries.update(message)
        }

        var chart2 = LightweightCharts.createChart(document.getElementById('chart2'), {
            width: 1000,
            height: 500,
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            priceScale: {
                borderColor: 'rgba(197, 203, 206, 0.8)',
            },
            timeScale: {
                borderColor: 'rgba(197, 203, 206, 0.8)',
                timeVisible: true,
                secondsVisible: false,
            },
        });

        var candleSeries2 = chart2.addCandlestickSeries()
        // var candleSeries = chart.addCandlestickSeries({
        //     upColor: '#00ff00',
        //     downColor: '#ff0000',
        //     borderDownColor: 'rgba(255, 144, 0, 1)',
        //     borderUpColor: 'rgba(255, 144, 0, 1)',
        //     wickDownColor: 'rgba(255, 144, 0, 1)',
        //     wickUpColor: 'rgba(255, 144, 0, 1)',
        // });

        fetch('http://localhost:8000/klines/spot/BTCUSDT')
            .then((r) => r.json())
            .then((response) => {
                console.log(response)

                candleSeries2.setData(response);
            })


        var binanceSockets2 = new WebSocket("ws://localhost:8000/ws/spot/BTCUSDT");

        binanceSockets2.onmessage = function (event) {
            var message = JSON.parse(event.data);
            candleSeries2.update(message)
        }
    </script>

    <!-- Optional JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>

</body>

</html>